<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FastGraph Spring Forces Demo</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            text-align: center;
        }
        
        h1 {
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .subtitle {
            font-size: 1.2em;
            opacity: 0.8;
            margin-bottom: 30px;
        }
        
        .demo-section {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }
        
        .status {
            background: rgba(0,0,0,0.3);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-family: monospace;
            font-size: 16px;
            line-height: 1.4;
        }
        
        .controls {
            margin-bottom: 30px;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        button {
            background: linear-gradient(135deg, #3498db, #2980b9);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        #fastgraph-container {
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 15px;
            display: inline-block;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .explanation {
            background: rgba(46, 204, 113, 0.2);
            border-left: 4px solid #2ecc71;
            padding: 20px;
            margin-top: 20px;
            border-radius: 0 10px 10px 0;
            text-align: left;
            line-height: 1.6;
        }
        
        .explanation h3 {
            margin-top: 0;
            color: #2ecc71;
        }
    </style>
    <script type="importmap">
        {
            "imports": {
                "react": "https://esm.sh/react@18",
                "react-dom": "https://esm.sh/react-dom@18",
                "react-dom/client": "https://esm.sh/react-dom@18/client"
            }
        }
    </script>
</head>
<body>
    <div class="container">
        <h1>üå∏ Spring Forces Demo</h1>
        <div class="subtitle">Watch how connected nodes act like springs! (GPU Accelerated)</div>
        
        <div class="demo-section">
            <div id="status" class="status">Loading spring demonstration...</div>
            
            <div class="controls">
                <button onclick="startLinearChain()">üîó Linear Chain</button>
                <button onclick="startTriangle()">üî∫ Triangle</button>
                <button onclick="startStar()">‚≠ê Star Pattern</button>
                <button onclick="startGrid()">‚öè Grid</button>
                <button onclick="addRandomVelocity()">üé≤ Add Random Push</button>
                <button onclick="togglePhysics()">‚èØÔ∏è Pause/Resume</button>
                <button onclick="resetDemo()">üîÑ Reset</button>
            </div>
            
            <div id="fastgraph-container"></div>
            
            <div class="explanation">
                <h3>üî¨ How Spring Forces Work:</h3>
                <ul>
                    <li><strong>Spring Force:</strong> Connected nodes try to maintain their ideal distance</li>
                    <li><strong>Too Close:</strong> Nodes push apart (repulsive force)</li>
                    <li><strong>Too Far:</strong> Nodes pull together (attractive force)</li>
                    <li><strong>Equilibrium:</strong> Nodes settle at the perfect spring length</li>
                    <li><strong>Damping:</strong> Friction gradually slows down the movement</li>
                </ul>
                <p><strong>Try the demos above to see different spring configurations in action!</strong></p>
                <p><em>üöÄ This demo uses experimental GPU compute shaders for enhanced performance!</em></p>
            </div>
        </div>
    </div>

    <script type="module">
        import React, { useState, useEffect } from "react";
        import { createRoot } from "react-dom/client";

        let currentRoot = null;
        let physicsEnabled = true;
        let currentDemo = 'linear';

        async function loadDemo() {
            const statusDiv = document.getElementById("status");
            const container = document.getElementById("fastgraph-container");

            try {
                statusDiv.textContent = "Loading FastGraph components...";

                const { 
                    FastGraph, 
                    generateLinearGraph,
                    generateGridGraph,
                    generateStarGraph,
                    addRandomVelocity 
                } = await import("./dist/index.esm.js");

                function SpringDemo() {
                    const [graphData, setGraphData] = useState(() => createLinearChain());
                    const [physicsActive, setPhysicsActive] = useState(true);
                    const [demoType, setDemoType] = useState('linear');

                    function createLinearChain() {
                        const nodes = [
                            { id: 'A', x: 0.2, y: 0.5, color: '#e74c3c', size: 12, vx: 0.02, vy: 0 },
                            { id: 'B', x: 0.4, y: 0.5, color: '#f39c12', size: 12, vx: -0.01, vy: 0.02 },
                            { id: 'C', x: 0.6, y: 0.5, color: '#2ecc71', size: 12, vx: 0.01, vy: -0.01 },
                            { id: 'D', x: 0.8, y: 0.5, color: '#3498db', size: 12, vx: -0.02, vy: 0.01 }
                        ];
                        const edges = [
                            { source: 'A', target: 'B', color: '#ffffff', width: 3 },
                            { source: 'B', target: 'C', color: '#ffffff', width: 3 },
                            { source: 'C', target: 'D', color: '#ffffff', width: 3 }
                        ];
                        return { nodes, edges };
                    }

                    function createTriangle() {
                        const nodes = [
                            { id: 'A', x: 0.5, y: 0.3, color: '#e74c3c', size: 15, vx: 0.03, vy: 0.02 },
                            { id: 'B', x: 0.3, y: 0.7, color: '#2ecc71', size: 15, vx: -0.02, vy: -0.01 },
                            { id: 'C', x: 0.7, y: 0.7, color: '#3498db', size: 15, vx: -0.01, vy: 0.03 }
                        ];
                        const edges = [
                            { source: 'A', target: 'B', color: '#ffffff', width: 4 },
                            { source: 'B', target: 'C', color: '#ffffff', width: 4 },
                            { source: 'C', target: 'A', color: '#ffffff', width: 4 }
                        ];
                        return { nodes, edges };
                    }

                    function createStarPattern() {
                        const center = { id: 'Center', x: 0.5, y: 0.5, color: '#f39c12', size: 18, vx: 0, vy: 0 };
                        const nodes = [center];
                        const edges = [];
                        
                        for (let i = 0; i < 5; i++) {
                            const angle = (i * 2 * Math.PI) / 5;
                            const radius = 0.25;
                            const x = 0.5 + radius * Math.cos(angle);
                            const y = 0.5 + radius * Math.sin(angle);
                            
                            const node = {
                                id: `Outer${i}`,
                                x, y,
                                color: `hsl(${i * 72}, 80%, 60%)`,
                                size: 12,
                                vx: (Math.random() - 0.5) * 0.04,
                                vy: (Math.random() - 0.5) * 0.04
                            };
                            
                            nodes.push(node);
                            edges.push({
                                source: 'Center',
                                target: `Outer${i}`,
                                color: '#ffffff',
                                width: 3
                            });
                        }
                        
                        return { nodes, edges };
                    }

                    function createGridPattern() {
                        const baseGrid = generateGridGraph(3, 3);
                        return {
                            nodes: baseGrid.nodes.map(node => ({
                                ...node,
                                vx: (Math.random() - 0.5) * 0.04,
                                vy: (Math.random() - 0.5) * 0.04,
                                size: 10
                            })),
                            edges: baseGrid.edges.map(edge => ({
                                ...edge,
                                color: '#ffffff',
                                width: 2
                            }))
                        };
                    }

                    // Global functions for buttons
                    window.startLinearChain = () => {
                        setGraphData(createLinearChain());
                        setDemoType('linear');
                        statusDiv.textContent = "üîó Linear Chain: 4 nodes connected in a line with spring forces";
                    };

                    window.startTriangle = () => {
                        setGraphData(createTriangle());
                        setDemoType('triangle');
                        statusDiv.textContent = "üî∫ Triangle: 3 nodes forming a triangle with equal spring connections";
                    };

                    window.startStar = () => {
                        setGraphData(createStarPattern());
                        setDemoType('star');
                        statusDiv.textContent = "‚≠ê Star: Center node connected to 5 outer nodes with springs";
                    };

                    window.startGrid = () => {
                        setGraphData(createGridPattern());
                        setDemoType('grid');
                        statusDiv.textContent = "‚öè Grid: 3x3 grid with spring connections between neighbors";
                    };

                    window.addRandomVelocity = () => {
                        setGraphData(prev => ({
                            nodes: prev.nodes.map(node => ({
                                ...node,
                                vx: (node.vx || 0) + (Math.random() - 0.5) * 0.06,
                                vy: (node.vy || 0) + (Math.random() - 0.5) * 0.06
                            })),
                            edges: prev.edges
                        }));
                        statusDiv.textContent = "üé≤ Added random velocities - watch the springs work!";
                    };

                    window.togglePhysics = () => {
                        physicsEnabled = !physicsEnabled;
                        setPhysicsActive(physicsEnabled);
                        statusDiv.textContent = physicsEnabled ? "‚ñ∂Ô∏è Physics resumed" : "‚è∏Ô∏è Physics paused";
                    };

                    window.resetDemo = () => {
                        switch(demoType) {
                            case 'linear': window.startLinearChain(); break;
                            case 'triangle': window.startTriangle(); break;
                            case 'star': window.startStar(); break;
                            case 'grid': window.startGrid(); break;
                        }
                    };

                    useEffect(() => {
                        statusDiv.textContent = "üîó Linear Chain: 4 nodes connected in a line with spring forces";
                    }, []);

                    return React.createElement(FastGraph, {
                        nodes: graphData.nodes,
                        edges: graphData.edges,
                        enablePhysics: physicsActive,
                        dampingFactor: 0.985,
                        springConstant: 0.025,
                        restLength: 0.18,
                        useGPUAcceleration: true,
                        width: 1000,
                        height: 600,
                        style: {
                            border: "3px solid rgba(255,255,255,0.4)",
                            borderRadius: "15px",
                            background: "linear-gradient(135deg, #000000 0%, #1a1a1a 100%)",
                            boxShadow: "0 15px 35px rgba(0,0,0,0.6)"
                        }
                    });
                }

                if (currentRoot) {
                    currentRoot.unmount();
                }

                currentRoot = createRoot(container);
                currentRoot.render(React.createElement(SpringDemo));

                statusDiv.textContent = "üéØ Spring forces demo ready! Try the different patterns above.";

            } catch (error) {
                statusDiv.textContent = `‚ùå Error loading demo: ${error.message}`;
                console.error('Spring demo error:', error);
            }
        }

        loadDemo();
    </script>
</body>
</html>